<div class="app-container">
  <mat-toolbar color="primary" class="app-toolbar">
    <mat-icon class="toolbar-icon">email</mat-icon>
    <span class="toolbar-title">{{ title }}</span>
    <span class="spacer"></span>
    <mat-icon class="toolbar-icon">smart_toy</mat-icon>
  </mat-toolbar>

  <div class="subtitle-container">
    <p class="subtitle">Classificação inteligente de emails com IA</p>
  </div>

  <div class="main-content">
    <div class="container">

      <mat-card class="input-card">
        <mat-card-header>
          <mat-card-title>
            <mat-icon>analytics</mat-icon>
            Analisar Email
          </mat-card-title>
          <mat-card-subtitle>
            Envie um email para classificação automática e geração de resposta sugerida
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <form [formGroup]="emailForm" (ngSubmit)="onSubmit()" class="email-form">

            <div class="input-method-section">
              <h3>Método de entrada</h3>
              <mat-radio-group formControlName="inputMethod" class="radio-group">
                <mat-radio-button value="text" class="radio-option">
                  <mat-icon>edit_note</mat-icon>
                  Digitar texto
                </mat-radio-button>
                <mat-radio-button value="file" class="radio-option">
                  <mat-icon>upload_file</mat-icon>
                  Upload arquivo
                </mat-radio-button>
              </mat-radio-group>
            </div>

            <mat-divider></mat-divider>

            <div class="file-upload-section" *ngIf="emailForm.value.inputMethod === 'file'">
              <input type="file" id="fileInput" accept=".txt,.pdf" (change)="onFileSelected($event)" class="file-input"
                #fileInput>

              <button mat-raised-button color="accent" type="button" (click)="fileInput.click()"
                class="file-upload-button">
                <mat-icon>cloud_upload</mat-icon>
                {{ selectedFile ? selectedFile.name : 'Selecionar arquivo (.txt, .pdf)' }}
              </button>
            </div>

            <div class="text-input-section" *ngIf="emailForm.value.inputMethod === 'text'">
              <mat-form-field appearance="outline" class="full-width">
                <mat-label>Conteúdo do Email</mat-label>
                <textarea matInput formControlName="emailText"
                  placeholder="Cole aqui o conteúdo do email que deseja classificar..." rows="8" cdkTextareaAutosize
                  #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="8" cdkAutosizeMaxRows="15">
                </textarea>
                <mat-icon matSuffix>description</mat-icon>
                <mat-error *ngIf="emailForm.get('emailText')?.hasError('required')">
                  O conteúdo do email é obrigatório
                </mat-error>
                <mat-error *ngIf="emailForm.get('emailText')?.hasError('minlength')">
                  O email deve ter pelo menos 10 caracteres
                </mat-error>
              </mat-form-field>
            </div>

            <mat-card class="file-preview-card" *ngIf="selectedFile && emailForm.value.emailText">
              <mat-card-header>
                <mat-card-title>
                  <mat-icon>preview</mat-icon>
                  Preview do arquivo
                </mat-card-title>
              </mat-card-header>
              <mat-card-content>
                <div class="preview-content">
                  {{ emailForm.value.emailText | slice:0:300 }}
                  <span *ngIf="emailForm.value.emailText.length > 300">...</span>
                </div>
              </mat-card-content>
            </mat-card>

            <mat-divider></mat-divider>

            <div class="form-actions">
              <button mat-raised-button color="primary" type="submit" [disabled]="emailForm.invalid || isProcessing"
                class="submit-button">
                <mat-spinner *ngIf="isProcessing" diameter="20" class="button-spinner"></mat-spinner>
                <mat-icon *ngIf="!isProcessing">psychology</mat-icon>
                {{ isProcessing ? 'Processando...' : 'Classificar Email' }}
              </button>

              <button mat-stroked-button color="warn" type="button" (click)="clearForm()" [disabled]="isProcessing">
                <mat-icon>clear_all</mat-icon>
                Limpar
              </button>
            </div>
          </form>
        </mat-card-content>
      </mat-card>

      <div class="results-section" *ngIf="result || error">

        <mat-card class="error-card" *ngIf="error">
          <mat-card-content>
            <div class="error-content">
              <mat-icon color="warn">error</mat-icon>
              <div>
                <h3>Erro no processamento</h3>
                <p>{{ error }}</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="results-card" *ngIf="result">
          <mat-card-header>
            <mat-card-title>
              <mat-icon>assessment</mat-icon>
              Resultado da Classificação
            </mat-card-title>
          </mat-card-header>

          <mat-card-content>
            <div class="classification-result">
              <div class="category-chips">
                <mat-chip [class]="result.category.toLowerCase()" class="category-chip" selected>
                  <mat-icon *ngIf="result.category === 'Produtivo'">check_circle</mat-icon>
                  <mat-icon *ngIf="result.category === 'Improdutivo'">remove_circle</mat-icon>
                  {{ result.category }}
                </mat-chip>
              </div>

              <div class="confidence-section">
                <div class="confidence-header">
                  <span class="confidence-label">Confiança:</span>
                  <span class="confidence-value">{{ (result.confidence * 100) | number:'1.1-1' }}%</span>
                </div>
                <mat-progress-bar mode="determinate" [value]="result.confidence * 100" class="confidence-bar">
                </mat-progress-bar>
              </div>
            </div>

            <mat-divider></mat-divider>

            <div class="suggested-response">
              <h3>
                <mat-icon>chat_bubble_outline</mat-icon>
                Resposta Sugerida
              </h3>

              <mat-card class="response-card">
                <mat-card-content>
                  <p class="response-text">{{ result.suggested_response }}</p>
                  <div class="response-actions">
                    <button mat-icon-button color="primary" (click)="copyResponse()" matTooltip="Copiar resposta"
                      matTooltipPosition="above">
                      <mat-icon>content_copy</mat-icon>
                    </button>
                  </div>
                </mat-card-content>
              </mat-card>
            </div>

            <div class="processing-info">
              <mat-icon class="info-icon">schedule</mat-icon>
              <span>Processado em {{ result.processing_time | number:'1.1-1' }}s</span>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <div class="features-section" *ngIf="!result && !error">
        <div class="features-grid">

          <mat-card class="feature-card">
            <mat-card-header>
              <div mat-card-avatar class="feature-avatar accuracy">
                <mat-icon>verified</mat-icon>
              </div>
              <mat-card-title>Classificação Precisa</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p>IA treinada para identificar emails produtivos e improdutivos com alta precisão</p>
            </mat-card-content>
          </mat-card>

          <mat-card class="feature-card">
            <mat-card-header>
              <div mat-card-avatar class="feature-avatar speed">
                <mat-icon>flash_on</mat-icon>
              </div>
              <mat-card-title>Processamento Rápido</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p>Análise instantânea do conteúdo com resposta em segundos</p>
            </mat-card-content>
          </mat-card>

          <mat-card class="feature-card">
            <mat-card-header>
              <div mat-card-avatar class="feature-avatar intelligence">
                <mat-icon>psychology</mat-icon>
              </div>
              <mat-card-title>Respostas Inteligentes</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <p>Sugestões de resposta contextualmente apropriadas para cada categoria</p>
            </mat-card-content>
          </mat-card>

        </div>
      </div>

    </div>
  </div>

  <div class="footer">
    <mat-divider></mat-divider>
    <div class="footer-content">
      <p>
        <mat-icon class="footer-icon">copyright</mat-icon>
        2024 AutoU - Desenvolvido para otimizar o atendimento por email
      </p>
    </div>
  </div>
</div>